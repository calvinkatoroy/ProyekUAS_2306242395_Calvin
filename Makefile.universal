# Universal Makefile - Calvin Wirathama Katoroy (NPM: 2306242395)

# Auto-detect OS
UNAME_S := $(shell uname -s 2>/dev/null || echo Windows)
ifeq ($(UNAME_S),Windows)
    EXE_EXT = .exe
    MKDIR = mkdir
    RM = del /Q
else
    EXE_EXT = 
    MKDIR = mkdir -p
    RM = rm -f
endif

# Compiler settings
CXX = g++
CXXFLAGS = -std=c++11 -Wall -Wextra -O2

# Executables
MAIN_EXEC = enhanced_analyzer$(EXE_EXT)
VIZ_EXEC = data_visualizer$(EXE_EXT)
SIMPLE_VIZ_EXEC = simple_visualizer$(EXE_EXT)

# One-command setup
.PHONY: plug-and-play
plug-and-play: setup dependencies all demo
	@echo "ğŸ‰ Plug-and-play setup completed!"

# Auto-detect and install dependencies
.PHONY: dependencies
dependencies:
	@echo "ğŸ” Checking dependencies..."
ifeq ($(UNAME_S),Linux)
	@which g++ > /dev/null || (echo "Installing g++..." && sudo apt-get update && sudo apt-get install -y build-essential)
endif
ifeq ($(UNAME_S),Darwin)
	@which g++ > /dev/null || (echo "Installing g++..." && xcode-select --install)
endif
	@echo "âœ… Dependencies checked!"

# Smart setup
.PHONY: setup
setup:
	@echo "ğŸ“ Creating directories..."
	@$(MKDIR) data/raw data/processed data/results docs/visualizations
	@echo "âœ… Setup completed!"

# Compile with error handling
.PHONY: all
all: $(MAIN_EXEC) $(VIZ_EXEC) $(SIMPLE_VIZ_EXEC)
	@echo "âœ… All programs compiled successfully!"

$(MAIN_EXEC): src/main.cpp src/network_analyzer.cpp
	@echo "ğŸ”§ Compiling enhanced analyzer..."
	@$(CXX) $(CXXFLAGS) -o $@ $^

$(VIZ_EXEC): data_visualizer.cpp
	@echo "ğŸ“Š Compiling visualizer..."
	@$(CXX) $(CXXFLAGS) -o $@ $^

$(SIMPLE_VIZ_EXEC): simple_visualizer.cpp
	@echo "ğŸ“ˆ Compiling ASCII visualizer..."
	@$(CXX) $(CXXFLAGS) -o $@ $^

# Demo workflow
.PHONY: demo
demo: $(MAIN_EXEC)
	@echo "ğŸ¬ Ready for demo! Run: ./$(MAIN_EXEC)"
	@echo "ğŸ’¡ Workflow: Menu 1â†’10â†’11â†’0, then 'make viz'"

# Easy visualization
.PHONY: viz
viz: $(SIMPLE_VIZ_EXEC)
	@echo "ğŸ“Š Generating visualizations..."
	@./$(SIMPLE_VIZ_EXEC)

# Help with OS-specific instructions
.PHONY: help
help:
	@echo "ğŸ¯ Method B Network Analyzer - Universal Build System"
	@echo "Calvin Wirathama Katoroy - NPM: 2306242395"
	@echo ""
	@echo "ğŸš€ One-command setup: make plug-and-play"
	@echo ""
	@echo "ğŸ“‹ Available targets:"
	@echo "  make plug-and-play  - Complete auto-setup (RECOMMENDED)"
	@echo "  make setup         - Create directories"
	@echo "  make all           - Compile programs"
	@echo "  make demo          - Ready for demonstration"
	@echo "  make viz           - Generate visualizations"
	@echo "  make dependencies  - Install missing dependencies"
	@echo ""
ifeq ($(UNAME_S),Windows)
	@echo "ğŸ’» Windows detected - use PowerShell: .\build.ps1 setup"
else
	@echo "ğŸ§ Unix detected - all make commands available"
endif